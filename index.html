<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HexWorlds - Enhanced Hex Map Editor</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app">
        <div class="topbar">
            <div class="topbar-left">
                <div class="logo">‚¨° HexWorlds</div>
                
                <!-- Dropdown Menu Bar -->
                <div class="menu-bar">
                    <div class="menu-item">
                        <button class="menu-button" onclick="toggleMenu('fileMenu')">File</button>
                        <div class="dropdown-menu" id="fileMenu">
                            <div class="menu-option" onclick="newMap()">
                                <span class="menu-option-label">
                                    <span class="menu-option-icon">üìÑ</span>
                                    New Map
                                </span>
                                <span class="menu-option-shortcut">Ctrl+N</span>
                            </div>
                            <div class="menu-option disabled">
                                <span class="menu-option-label">
                                    <span class="menu-option-icon">üìÇ</span>
                                    Open Recent
                                </span>
                                <span class="menu-option-shortcut">Soon</span>
                            </div>
                            <div class="menu-separator"></div>
                            <div class="menu-option" onclick="importHexMap(); closeAllMenus();">
                                <span class="menu-option-label">
                                    <span class="menu-option-icon">üì•</span>
                                    Import World
                                </span>
                                <span class="menu-option-shortcut">Ctrl+O</span>
                            </div>
                            <div class="menu-option" onclick="exportHexMap(); closeAllMenus();">
                                <span class="menu-option-label">
                                    <span class="menu-option-icon">üíæ</span>
                                    Export World
                                </span>
                                <span class="menu-option-shortcut">Ctrl+S</span>
                            </div>
                            <div class="menu-separator"></div>
                            <div class="menu-option disabled">
                                <span class="menu-option-label">
                                    <span class="menu-option-icon">üë§</span>
                                    Account
                                </span>
                                <span class="menu-option-shortcut">Soon</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="menu-item">
                        <button class="menu-button" onclick="toggleMenu('editMenu')">Edit</button>
                        <div class="dropdown-menu" id="editMenu">
                            <div class="menu-option disabled">
                                <span class="menu-option-label">
                                    <span class="menu-option-icon">‚Ü∂</span>
                                    Undo
                                </span>
                                <span class="menu-option-shortcut">Ctrl+Z</span>
                            </div>
                            <div class="menu-option disabled">
                                <span class="menu-option-label">
                                    <span class="menu-option-icon">‚Ü∑</span>
                                    Redo
                                </span>
                                <span class="menu-option-shortcut">Ctrl+Y</span>
                            </div>
                            <div class="menu-separator"></div>
                            <div class="menu-option" onclick="clearSelection(); closeAllMenus();">
                                <span class="menu-option-label">
                                    <span class="menu-option-icon">‚úï</span>
                                    Clear Selection
                                </span>
                                <span class="menu-option-shortcut">Esc</span>
                            </div>
                            <div class="menu-option" onclick="clearHexMap(); closeAllMenus();">
                                <span class="menu-option-label">
                                    <span class="menu-option-icon">üóëÔ∏è</span>
                                    Clear Map
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="menu-item">
                        <button class="menu-button" onclick="toggleMenu('viewMenu')">View</button>
                        <div class="dropdown-menu" id="viewMenu">
                            <div class="menu-option" onclick="zoomIn(); closeAllMenus();">
                                <span class="menu-option-label">
                                    <span class="menu-option-icon">üîç</span>
                                    Zoom In
                                </span>
                                <span class="menu-option-shortcut">+</span>
                            </div>
                            <div class="menu-option" onclick="zoomOut(); closeAllMenus();">
                                <span class="menu-option-label">
                                    <span class="menu-option-icon">üîç</span>
                                    Zoom Out
                                </span>
                                <span class="menu-option-shortcut">-</span>
                            </div>
                            <div class="menu-option" onclick="resetZoom(); closeAllMenus();">
                                <span class="menu-option-label">
                                    <span class="menu-option-icon">‚ü≤</span>
                                    Reset Zoom
                                </span>
                                <span class="menu-option-shortcut">0</span>
                            </div>
                            <div class="menu-separator"></div>
                            <div class="menu-option" onclick="toggleAllLayers(true); closeAllMenus();">
                                <span class="menu-option-label">
                                    <span class="menu-option-icon">üëÅÔ∏è</span>
                                    Show All Layers
                                </span>
                            </div>
                            <div class="menu-option" onclick="toggleAllLayers(false); closeAllMenus();">
                                <span class="menu-option-label">
                                    <span class="menu-option-icon">üö´</span>
                                    Hide All Layers
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="breadcrumb">
                    <span id="viewName">Hex Map</span>
                </div>
            </div>
            <div class="topbar-right" id="topbarActions"></div>
        </div>

        <div class="main">
            <div class="sidebar-left">
                <!-- View Mode Toggle -->
                <div class="view-mode-section">
                    <h3 style="margin-bottom: 12px;">View Mode</h3>
                    <div class="view-mode-toggle">
                        <button class="view-mode-option active" onclick="setViewMode('builder')" data-view-mode="builder">
                            <div class="view-mode-icon">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                                </svg>
                            </div>
                            Builder
                        </button>
                        <button class="view-mode-option" onclick="setViewMode('explorer')" data-view-mode="explorer">
                            <div class="view-mode-icon">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                                </svg>
                            </div>
                            Explorer
                        </button>
                    </div>
                </div>

                <!-- Tools Section (Builder Mode Only) -->
                <div class="tool-section" id="toolsSection">
                    <h3>Tools</h3>
                    <div class="mode-selector">
                        <button class="mode-btn active" onclick="setHexMode('paint')" data-mode="paint">
                            <div class="mode-icon">
                                <svg viewBox="0 0 512 512" fill="currentColor">
                                    <path d="M490.3 40.4C512.2 62.27 512.2 97.73 490.3 119.6L460.3 149.7L362.3 51.72L392.4 21.66C414.3-.2135 449.7-.2135 471.6 21.66L490.3 40.4zM172.4 241.7L339.7 74.34L437.7 172.3L270.3 339.6C264.2 345.8 256.7 350.4 248.4 353.2L159.6 382.8C150.1 385.6 141.5 383.4 135 376.1C128.6 370.5 126.4 361 129.2 352.4L158.8 263.6C161.6 255.3 166.2 247.8 172.4 241.7V241.7zM192 63.1C209.7 63.1 224 78.33 224 95.1C224 113.7 209.7 127.1 192 127.1H96C78.33 127.1 64 142.3 64 159.1V416C64 433.7 78.33 448 96 448H352C369.7 448 384 433.7 384 416V319.1C384 302.3 398.3 287.1 416 287.1C433.7 287.1 448 302.3 448 319.1V416C448 469 405 512 352 512H96C42.98 512 0 469 0 416V159.1C0 106.1 42.98 63.1 96 63.1H192z"/>
                                </svg>
                            </div>
                            Terrain
                        </button>
                        <button class="mode-btn" onclick="setHexMode('token')" data-mode="token">
                            <div class="mode-icon">
                                <svg viewBox="0 0 512 512" fill="currentColor">
                                    <path d="M256 0c-70.7 0-128 57.3-128 128 0 70.7 103.8 206.4 119.4 226.4 3.1 4 7.9 6.3 13.1 6.3s10-2.3 13.1-6.3C289.2 334.4 384 198.7 384 128 384 57.3 326.7 0 256 0zm0 192c-35.3 0-64-28.7-64-64s28.7-64 64-64 64 28.7 64 64-28.7 64-64 64z"/>
                                </svg>
                            </div>
                            Token
                        </button>
                        <button class="mode-btn" onclick="setHexMode('path')" data-mode="path">
                            <div class="mode-icon">
                                <svg viewBox="0 0 512 512" fill="currentColor">
                                    <g><circle cx="80" cy="80" r="32"/><circle cx="432" cy="80" r="32"/><circle cx="432" cy="432" r="32"/><circle cx="80" cy="432" r="32"/><circle cx="256" cy="160" r="24"/><circle cx="352" cy="256" r="24"/><circle cx="256" cy="352" r="24"/><circle cx="160" cy="256" r="24"/></g>
                                </svg>
                            </div>
                            Path
                        </button>
                        <button class="mode-btn" onclick="setHexMode('landmark')" data-mode="landmark">
                            <div class="mode-icon">
                                <svg viewBox="0 0 512 512" fill="currentColor">
                                    <path d="M256 32C132.3 32 32 132.3 32 256s100.3 224 224 224 224-100.3 224-224S379.7 32 256 32zm0 400c-97.2 0-176-78.8-176-176S158.8 80 256 80s176 78.8 176 176-78.8 176-176 176zm0-288c-61.9 0-112 50.1-112 112s50.1 112 112 112 112-50.1 112-112-50.1-112-112-112zm0 176c-35.3 0-64-28.7-64-64s28.7-64 64-64 64 28.7 64 64-28.7 64-64 64z"/>
                                </svg>
                            </div>
                            Landmark
                        </button>
                    </div>
                </div>

                <!-- Brush Settings -->
                <div class="tool-section" id="brushSettingsSection">
                    <h3>Brush Settings</h3>
                    <div class="brush-controls">
                        <div class="brush-control">
                            <label>
                                <input type="checkbox" id="fillMode" onchange="toggleFillMode(this.checked)" style="margin-right: 8px;">
                                Fill Connected Area
                            </label>
                            <div style="font-size: 11px; color: #718096; margin-top: 4px;">Paint all connected hexes at once</div>
                        </div>
                        
                        <div class="brush-control">
                            <label>Brush Size</label>
                            <div class="slider-container">
                                <input type="range" class="slider" id="brushSize" 
                                       min="1" max="5" value="1" 
                                       oninput="updateBrushSize(this.value)">
                                <span class="slider-value" id="brushSizeValue">1</span>
                            </div>
                        </div>

                        <div class="brush-control">
                            <label>Paint Speed</label>
                            <div class="slider-container">
                                <input type="range" class="slider" id="paintSpeed" 
                                       min="1" max="10" value="8" 
                                       oninput="updatePaintSpeed(this.value)">
                                <span class="slider-value" id="paintSpeedValue">8</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Terrain Palette -->
                <div class="tool-section" id="terrainPaletteSection">
                    <h3>Terrain Brush</h3>
                    <div class="terrain-grid" id="terrainPalette"></div>
                </div>

                <!-- Token Creator -->
                <div class="tool-section" id="tokenCreatorSection" style="display: none;">
                    <h3>Create Token</h3>
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <button class="btn btn-primary" style="width: 100%;" onclick="showTokenCreator()">
                            ‚ûï New Token
                        </button>
                        <div style="font-size: 11px; color: #718096; line-height: 1.5;">
                            <strong>Token Mode:</strong><br>
                            ‚Ä¢ Click hex to place new token<br>
                            ‚Ä¢ Click token to select/view<br>
                            ‚Ä¢ Drag token to move it<br>
                        </div>
                    </div>
                </div>

                <!-- Landmark Creator -->
                <div class="tool-section" id="landmarkCreatorSection" style="display: none;">
                    <h3>Create Landmark</h3>
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <button class="btn btn-primary" style="width: 100%;" onclick="showLandmarkCreator()">
                            ‚ûï New Landmark
                        </button>
                        <div style="font-size: 11px; color: #718096; line-height: 1.5;">
                            <strong>Landmark Mode:</strong><br>
                            ‚Ä¢ Click hex to place landmark<br>
                            ‚Ä¢ Shift+Click landmark to select<br>
                            ‚Ä¢ Landmarks appear on hex terrain<br>
                        </div>
                    </div>
                </div>

                <!-- Path Creator -->
                <div class="tool-section" id="pathCreatorSection" style="display: none;">
                    <h3>Path Type</h3>
                    <div style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 16px;">
                        <button class="btn btn-secondary" style="width: 100%; justify-content: center; gap: 8px;" 
                                onclick="selectPathType('road')" id="pathType_road">
                            <svg style="width: 16px; height: 16px; fill: currentColor;" viewBox="0 0 512 512">
                                <path d="M416 96c0-17.7-14.3-32-32-32s-32 14.3-32 32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16zm-96 48c-17.7 0-32 14.3-32 32s14.3 32 32 32 32-14.3 32-32-14.3-32-32-32zm-96 64c-17.7 0-32 14.3-32 32s14.3 32 32 32 32-14.3 32-32-14.3-32-32-32zm-96 64c-17.7 0-32 14.3-32 32s14.3 32 32 32 32-14.3 32-32-14.3-32-32-32zm288-176c-17.7 0-32 14.3-32 32s14.3 32 32 32 32-14.3 32-32-14.3-32-32-32z"/>
                            </svg>
                            Road
                        </button>
                        <button class="btn btn-secondary" style="width: 100%; justify-content: center; gap: 8px;" 
                                onclick="selectPathType('river')" id="pathType_river">
                            <svg style="width: 16px; height: 16px; fill: currentColor;" viewBox="0 0 512 512">
                                <path d="M96 32c-17.7 0-32 14.3-32 32v64c0 17.7 14.3 32 32 32s32-14.3 32-32V64c0-17.7-14.3-32-32-32zm160 0c-17.7 0-32 14.3-32 32v64c0 17.7 14.3 32 32 32s32-14.3 32-32V64c0-17.7-14.3-32-32-32zm160 0c-17.7 0-32 14.3-32 32v64c0 17.7 14.3 32 32 32s32-14.3 32-32V64c0-17.7-14.3-32-32-32zM96 192c-17.7 0-32 14.3-32 32v64c0 17.7 14.3 32 32 32s32-14.3 32-32v-64c0-17.7-14.3-32-32-32zm160 0c-17.7 0-32 14.3-32 32v64c0 17.7 14.3 32 32 32s32-14.3 32-32v-64c0-17.7-14.3-32-32-32zm160 0c-17.7 0-32 14.3-32 32v64c0 17.7 14.3 32 32 32s32-14.3 32-32v-64c0-17.7-14.3-32-32-32zM96 352c-17.7 0-32 14.3-32 32v64c0 17.7 14.3 32 32 32s32-14.3 32-32v-64c0-17.7-14.3-32-32-32zm160 0c-17.7 0-32 14.3-32 32v64c0 17.7 14.3 32 32 32s32-14.3 32-32v-64c0-17.7-14.3-32-32-32zm160 0c-17.7 0-32 14.3-32 32v64c0 17.7 14.3 32 32 32s32-14.3 32-32v-64c0-17.7-14.3-32-32-32z"/>
                            </svg>
                            River
                        </button>
                        <button class="btn btn-secondary" style="width: 100%; justify-content: center; gap: 8px;" 
                                onclick="selectPathType('trail')" id="pathType_trail">
                            <svg style="width: 16px; height: 16px; fill: currentColor;" viewBox="0 0 512 512">
                                <path d="M192 96c0-17.7-14.3-32-32-32h-32c-17.7 0-32 14.3-32 32v32c0 17.7 14.3 32 32 32h32c17.7 0 32-14.3 32-32V96zm96 64h32c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32h-32c-17.7 0-32 14.3-32 32v32c0 17.7 14.3 32 32 32zm-96 64c0-17.7-14.3-32-32-32h-32c-17.7 0-32 14.3-32 32v32c0 17.7 14.3 32 32 32h32c17.7 0 32-14.3 32-32v-32zm96 64h32c17.7 0 32-14.3 32-32v-32c0-17.7-14.3-32-32-32h-32c-17.7 0-32 14.3-32 32v32c0 17.7 14.3 32 32 32zm-96 64c0-17.7-14.3-32-32-32h-32c-17.7 0-32 14.3-32 32v32c0 17.7 14.3 32 32 32h32c17.7 0 32-14.3 32-32v-32z"/>
                            </svg>
                            Trail
                        </button>
                    </div>
                    
                    <h3>Path Style</h3>
                    <div style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 16px;">
                        <button class="btn btn-secondary" style="width: 100%; justify-content: center;" 
                                onclick="selectPathStyle('straight')" id="pathStyle_straight">
                            ‚îÅ Straight
                        </button>
                        <button class="btn btn-secondary" style="width: 100%; justify-content: center;" 
                                onclick="selectPathStyle('curved')" id="pathStyle_curved">
                            ‚å¢ Curved
                        </button>
                    </div>
                    
                    <div class="brush-control">
                        <label>Path Width</label>
                        <div class="slider-container">
                            <input type="range" class="slider" id="pathWidth" 
                                   min="2" max="12" value="4" 
                                   oninput="updatePathWidth(this.value)">
                            <span class="slider-value" id="pathWidthValue">4</span>
                        </div>
                    </div>
                    
                    <div class="brush-control">
                        <label>Path Color</label>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <input type="color" id="pathColor" value="#8B7355" 
                                   onchange="updatePathColor(this.value)"
                                   style="width: 50px; height: 30px; border: 2px solid #3d4758; border-radius: 6px; background: transparent; cursor: pointer;">
                            <button class="btn btn-secondary" style="font-size: 11px; padding: 6px 10px;" 
                                    onclick="resetPathColorToDefault()">Reset to Default</button>
                        </div>
                    </div>
                    
                    <div style="font-size: 11px; color: #718096; line-height: 1.5; margin-top: 16px;">
                        <strong>Path Mode:</strong><br>
                        ‚Ä¢ Click hexes to draw path<br>
                        ‚Ä¢ Paths auto-connect at intersections<br>
                        ‚Ä¢ Double-click to finish<br>
                        ‚Ä¢ Click existing path to edit/delete<br>
                        ‚Ä¢ ESC to cancel current path<br>
                    </div>
                </div>
            </div>

            <div class="canvas-container">
                <canvas id="hexCanvas"></canvas>
                
                <div class="canvas-overlay">
                    <strong id="modeText">Paint Mode</strong> ¬∑ <span id="terrainText">Plains</span> selected<br>
                    <span id="instructionText">Click to paint ¬∑ Drag for multiple ¬∑ Keys 1-5 for brush size</span>
                </div>

                <div class="zoom-controls">
                    <button class="zoom-btn" onclick="zoomIn()">+</button>
                    <button class="zoom-btn zoom-level" id="zoomLevel">100%</button>
                    <button class="zoom-btn" onclick="zoomOut()">‚àí</button>
                </div>

                <!-- Minimap Toggle Button -->
                <button class="minimap-toggle" onclick="toggleMinimap()" id="minimapToggle">
                    üó∫Ô∏è
                </button>
            </div>

            <!-- Minimap Panel -->
            <div class="minimap-panel" id="minimapPanel">
                <div class="minimap-header">
                    <h3>üó∫Ô∏è Minimap</h3>
                    <button class="minimap-close" onclick="toggleMinimap()">√ó</button>
                </div>
                <div class="minimap-content">
                    <div class="minimap-canvas-container">
                        <canvas id="minimapCanvas" width="250" height="250"></canvas>
                    </div>
                    <div class="minimap-stats">
                        <div class="minimap-stat">
                            <span class="minimap-stat-label">Total Hexes</span>
                            <span class="minimap-stat-value" id="minimapHexCount">0</span>
                        </div>
                        <div class="minimap-stat">
                            <span class="minimap-stat-label">Landmarks</span>
                            <span class="minimap-stat-value" id="minimapLandmarkCount">0</span>
                        </div>
                        <div class="minimap-stat">
                            <span class="minimap-stat-label">Tokens</span>
                            <span class="minimap-stat-value" id="minimapTokenCount">0</span>
                        </div>
                        <div class="minimap-stat">
                            <span class="minimap-stat-label">Paths</span>
                            <span class="minimap-stat-value" id="minimapPathCount">0</span>
                        </div>
                        <div class="minimap-stat">
                            <span class="minimap-stat-label">Zoom Level</span>
                            <span class="minimap-stat-value" id="minimapZoom">100%</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sidebar-right" id="hexDetailsPanel">
                <div class="no-selection">
                    <div class="no-selection-icon">‚¨°</div>
                    <p>Select a hex to view details</p>
                    <p style="margin-top: 8px; font-size: 12px;">Click any hex on the map</p>
                </div>
            </div>
        </div>
    </div>

    <script src="game.js"></script>
</body>
</html>
